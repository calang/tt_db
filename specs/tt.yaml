---
# This specification creates tables that correspond to each Prolog predicate:

# constantes - For storing lecc_por_sem and lecc_por_dia
# grupos - For the grupo/2 predicate
# aulas - For the aula/2 predicate
# profesores - For the prof/2 predicate
# grupo_materias - For grupo_materia_lecciones/4
# prof_grupo_materias - For prof_grupo_materia/3
# dias, bloques, lecciones - For the basic facts used in dia_bloque_leccion/3
# disponibilidad_profesores - For disp_prof_dia_bloque_leccion/4

DatabaseSpec:
  tables:
    - name: constantes
      columns:
        - name: name
          type: string
          not_null: true
        - name: value
          type: integer
          not_null: true
      constraints:
        - type: PRIMARY KEY
          columns: [name]

    - name: grupos
      columns:
        - name: id
          type: integer
          not_null: true
        - name: nombre
          type: string
          not_null: true
      constraints:
        - type: PRIMARY KEY
          columns: [id]
        - type: UNIQUE
          columns: [nombre]

    - name: materias
      columns:
        - name: id
          type: integer
          not_null: true
        - name: nombre
          type: string
          not_null: true
      constraints:
        - type: PRIMARY KEY
          columns: [id]
        - type: UNIQUE
          columns: [nombre]

    # - name: aulas
    #   columns:
    #     - name: id
    #       type: integer
    #       not_null: true
    #     - name: nombre
    #       type: string
    #       not_null: true
    #   constraints:
    #     - type: PRIMARY KEY
    #       columns: [id]
    #     - type: UNIQUE
    #       columns: [nombre]

    - name: profesores
      columns:
        - name: id
          type: integer
          not_null: true
        - name: nombre
          type: string
          not_null: true
      constraints:
        - type: PRIMARY KEY
          columns: [id]
        - type: UNIQUE
          columns: [nombre]

    - name: grupo_materias
      columns:
        - name: id
          type: integer
          not_null: true
        - name: grupo_id
          type: integer
          not_null: true
        - name: materia_id
          type: integer
          not_null: true
        - name: lecciones
          type: integer
          not_null: true
      constraints:
        - type: PRIMARY KEY
          columns: [id]
        - type: UNIQUE
          columns: [grupo_id, materia_id]

    - name: prof_grupo_materias
      columns:
        - name: profesor_id
          type: integer
          not_null: true
        - name: grupo_materias_id
          type: integer
          not_null: true
      constraints:
        - type: PRIMARY KEY
          columns: [profesor_id, grupo_materias_id]

    - name: dias
      columns:
        - name: nombre
          type: string
          not_null: true
      constraints:
        - type: PRIMARY KEY
          columns: [nombre]

    - name: bloques
      columns:
        - name: numero
          type: integer
          not_null: true
      constraints:
        - type: PRIMARY KEY
          columns: [numero]

    - name: lecciones
      columns:
        - name: id
          type: string
          not_null: true
      constraints:
        - type: PRIMARY KEY
          columns: [id]

    - name: disponibilidad_profesores
      columns:
        - name: profesor_id
          type: integer
          not_null: true
        - name: dia
          type: string
          not_null: true
        - name: bloque
          type: integer
          not_null: true
        - name: leccion
          type: string
          not_null: true
      constraints:
        - type: PRIMARY KEY
          columns: [profesor_id, dia, bloque, leccion]

  foreign_keys:
    - table: grupo_materias
      columns: [grupo_id]
      references:
        table: grupos
        columns: [id]

    - table: grupo_materias
      columns: [materia_id]
      references:
        table: materia
        columns: [id]

    - table: prof_grupo_materias
      columns: [profesor_id]
      references:
        table: profesores
        columns: [id]

    - table: prof_grupo_materias
      columns: [grupo_id]
      references:
        table: grupo_materias
        columns: [id]

    - table: disponibilidad_profesores
      columns: [profesor_id]
      references:
        table: profesores
        columns: [id]

    - table: disponibilidad_profesores
      columns: [dia]
      references:
        table: dias
        columns: [nombre]

    - table: disponibilidad_profesores
      columns: [bloque]
      references:
        table: bloques
        columns: [numero]

    - table: disponibilidad_profesores
      columns: [leccion]
      references:
        table: lecciones
        columns: [id]
