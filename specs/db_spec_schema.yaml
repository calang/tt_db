---
$schema: https://json-schema.org/draft/2020-12/schema
title: DB Schema
description: "Spec for a data base"
type: object
required: [ DatabaseSpec ]
properties:
  DatabaseSpec:
    type: object
    properties:
      schemas:
        type: array
        items:
          $ref: '#/components/SchemaSpec'
      tables:
        type: array
        items:
          $ref: '#/components/TableSpec'
      foreign_keys:
        type: array
        items:
          $ref: '#/components/ForeignKeySpec'
    required: ['tables']

components:
  SchemaSpec:
    type: object
    properties:
      name:
        type: string
    # owner:
    #   type: string
    # grants:
    #   type: array
    #   items:
    #     $ref: '#/components/GrantSpec'
    required: ['name']

  TableSpec:
    type: object
    properties:
      schema:
        type: string
        description: Schema name for the table
        default: public
      name:
        type: string
      columns:
        type: array
        items:
          $ref: '#/components/ColumnSpec'
      constraints:
        type: array
        items:
          $ref: '#/components/ConstraintSpec'
      # owner:
      #   type: string
      # grants:
      #   type: array
      #   items:
      #     $ref: '#/components/GrantSpec'
    required: ['name', 'columns']

  ColumnSpec:
    type: object
    properties:
      name:
        type: string
      type:
        "enum": ["string", "number", "boolean", "integer"]
      default:
        oneOf:
          - type: string
          - type: number
          - type: boolean
          - type: integer
      not_null:
        type: boolean
      unique:
        type: boolean
    required: ['name', 'type']

  ConstraintSpec:
    type: object
    properties:
      type:
        type: string
        enum: ['PRIMARY KEY', 'FOREIGN KEY', 'CHECK', 'UNIQUE']
      columns:
        type: array
        items:
          type: string
      expression:
        type: string

  ForeignKeySpec:
    type: object
    properties:
      schema:
        type: string
        default: public
      table:
        type: string
      columns:
        type: array
        items:
          type: string
      references:
        type: object
        properties:
          schema:
            type: string
            default: public
          table:
            type: string
          columns:
            type: array
            items:
              type: string
        required: ['table', 'columns']
    required: ['table', 'columns', 'references']

  # GrantSpec:
  #   type: object
  #   properties:
  #     role:
  #       type: string
  #     privileges:
  #       type: array
  #       items:
  #         type: string
  #     with_grant_option:
  #       type: boolean
